<!DOCTYPE html>
<html>
<head>
    <title>Domain Radar - Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <script src="/i18n.js"></script>
    <style>
        .lang-switch {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: 1px solid var(--border-color);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <button id="lang-switcher" class="lang-switch" onclick="toggleLanguage()">English</button>
    <div class="container-sm">
        <div class="text-center mb-4">
            <h1 data-i18n="heading">ðŸ“¡ Domain Radar</h1>
            <p data-i18n="subheading">Your insight into domain trends.</p>
        </div>
        
        <div class="card">
            <h2 class="text-center" data-i18n="welcome">Welcome Back</h2>
            <div id="message" class="alert" style="display: none;"></div>
            
            <div class="form-group">
                <label for="username" data-i18n="username_label">Username</label>
                <input type="text" id="username" class="input" placeholder="Enter your username" data-i18n="username_placeholder">
            </div>
            
            <div class="form-group">
                <label for="password" data-i18n="password_label">Password</label>
                <input type="password" id="password" class="input" placeholder="Enter your password" data-i18n="password_placeholder">
            </div>
            
            <div class="flex gap-2 mt-4">
                <button onclick="login()" class="btn btn-primary" data-i18n="login_btn">Login</button>
                <button onclick="register()" class="btn btn-outline" data-i18n="register_btn">Register</button>
            </div>
        </div>
        
        <p class="text-center" style="font-size: 0.875rem;" data-i18n="footer">
            &copy; 2024 Domain Radar. All rights reserved.
        </p>
    </div>

    <script>
        function showMessage(msg, type) {
            const el = document.getElementById('message');
            el.innerText = msg;
            el.style.display = 'block';
            el.className = 'alert ' + (type === 'error' ? 'alert-error' : 'alert-success');
        }

        async function login() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            
            if (!u || !p) {
                showMessage(t("msg_enter_both"), "error");
                return;
            }

            try {
                const res = await fetch('/v1/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if (data.token) {
                    localStorage.setItem('token', data.token);
                    window.location.href = '/dashboard';
                } else {
                    showMessage(t("msg_login_failed") + ": " + (data.message || "Unknown error"), "error");
                }
            } catch (e) {
                showMessage(t("msg_network_error"), "error");
            }
        }

        async function register() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;

            if (!u || !p) {
                showMessage(t("msg_enter_both"), "error");
                return;
            }

            try {
                const res = await fetch('/v1/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if (data.success) {
                    showMessage(t("msg_register_success"), "success");
                } else {
                    showMessage(data.message || t("msg_register_failed"), "error");
                }
            } catch (e) {
                showMessage(t("msg_network_error"), "error");
            }
        }
    </script>
</body>
</html>
