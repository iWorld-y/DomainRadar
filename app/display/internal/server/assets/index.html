<!DOCTYPE html>
<html>
<head>
    <title>Domain Radar - Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container-sm">
        <div class="text-center mb-4">
            <h1>ðŸ“¡ Domain Radar</h1>
            <p>Your insight into domain trends.</p>
        </div>
        
        <div class="card">
            <h2 class="text-center">Welcome Back</h2>
            <div id="message" class="alert" style="display: none;"></div>
            
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" class="input" placeholder="Enter your username">
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="input" placeholder="Enter your password">
            </div>
            
            <div class="flex gap-2 mt-4">
                <button onclick="login()" class="btn btn-primary">Login</button>
                <button onclick="register()" class="btn btn-outline">Register</button>
            </div>
        </div>
        
        <p class="text-center" style="font-size: 0.875rem;">
            &copy; 2024 Domain Radar. All rights reserved.
        </p>
    </div>

    <script>
        function showMessage(msg, type) {
            const el = document.getElementById('message');
            el.innerText = msg;
            el.style.display = 'block';
            el.className = 'alert ' + (type === 'error' ? 'alert-error' : 'alert-success');
        }

        async function login() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            
            if (!u || !p) {
                showMessage("Please enter both username and password", "error");
                return;
            }

            try {
                const res = await fetch('/v1/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if (data.token) {
                    localStorage.setItem('token', data.token);
                    window.location.href = '/dashboard';
                } else {
                    showMessage("Login failed: " + (data.message || "Unknown error"), "error");
                }
            } catch (e) {
                showMessage("Network error", "error");
            }
        }

        async function register() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;

            if (!u || !p) {
                showMessage("Please enter both username and password", "error");
                return;
            }

            try {
                const res = await fetch('/v1/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if (data.success) {
                    showMessage("Registered successfully! You can now login.", "success");
                } else {
                    showMessage(data.message || "Register failed", "error");
                }
            } catch (e) {
                showMessage("Network error", "error");
            }
        }
    </script>
</body>
</html>
